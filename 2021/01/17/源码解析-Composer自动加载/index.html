
<!DOCTYPE html>
<html lang="">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme-color" content="#202020">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  
    <meta name="keywords" content>
  

  
    <meta name="description" content="源码解析-composer自动加载">
  
  
  <link rel="icon" type="image/x-icon" href="/logo.png">
  <title>源码解析-composer自动加载 [ Void ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    
      <link rel="stylesheet" href="/css/microb.css">
    
      <link rel="stylesheet" href="/css/iconfont.css">
    
  
</head>

<body>
  <nav class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed">
  <!-- <ul class="pure-menu-list float-r clearfix">
    
      <li class="pure-menu-item toc-menu">
        <a id="menu-main-post" class="pure-menu-link" href="javascript:;">
          <img class="menu-icon" src="/logo.png" alt="MENU">
        </a>
      </li>
    
  </ul>   -->
  <a class="pure-menu-heading" href="/">
      <h1 class="title">Void</h1>
      <!-- <span>一个后端程序员</span> -->
  </a>

  <a href="/about" class="pure-menu-item pure-menu-has-children">
    <h2 class="subtitle">about</h2>
  </a>

  <!-- 
  <img class="logo" id="logo" src="/logo.png" alt="logo">
   -->
</nav>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <article class="post" id="post">
  <header class="post-header text-center">
    <h1 class="title">
      源码解析-composer自动加载
    </h1>
    
    <time class="time" datetime="2021-01-17T15:15:52.000Z">
      2021-01-17
    </time>
    
    <hr>
  </header>
  <div class="post-content">
    <blockquote>
<p>这里的Composer仅仅是自动加载的部分。</p>
</blockquote>
<p>  首先，我们从入口看起就是各种代码中都会写的<code>vendor/autoload.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// autoload.php @generated by Composer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里实际上就是下面的ComposerAutoloaderInitff0a7bcb47a4ebf1366823fdce0566b1</span></span><br><span class="line"><span class="comment">#因为这里还没自动加载 所以先require后调用静态方法</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/composer/autoload_real.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里类名为什么是随机生成的 我也不知道 我找了一个我觉得靠谱的答案</span></span><br><span class="line"><span class="comment"># 答案内说的 是避免多个composer自动加载类名会出现冲突</span></span><br><span class="line"><span class="comment"># https://stackoverflow.com/questions/57540826/whats-the-role-of-the-random-string-after-composerautoloaderinit-in-autoload-ph</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ComposerAutoloaderInitff0a7bcb47a4ebf1366823fdce0566b1::getLoader();</span><br></pre></td></tr></table></figure>
<p>然后我们进入<code>getLoader()</code>方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getLoader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  	<span class="comment">#这里很明显是一个单例 $loader是一个全局静态变量 只加载一次</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> !== <span class="keyword">self</span>::$loader) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$loader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">#这里的检查代码下面解释</span></span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/platform_check.php'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#这里注册自动加载 然后注入单例</span></span><br><span class="line">  spl_autoload_register(<span class="keyword">array</span>(<span class="string">'ComposerAutoloaderInitff0a7bcb47a4ebf1366823fdce0566b1'</span>, <span class="string">'loadClassLoader'</span>), <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">  	</span><br><span class="line">  	<span class="comment">#生成单例</span></span><br><span class="line">    <span class="keyword">self</span>::$loader = $loader = <span class="keyword">new</span> \Composer\Autoload\ClassLoader();</span><br><span class="line">    </span><br><span class="line">  	<span class="comment">#注册完成ClassLoader后 卸载</span></span><br><span class="line"> spl_autoload_unregister(<span class="keyword">array</span>(<span class="string">'ComposerAutoloaderInitff0a7bcb47a4ebf1366823fdce0566b1'</span>, <span class="string">'loadClassLoader'</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">#用于判断是不是 HHVM </span></span><br><span class="line">  <span class="comment">#查询了zend_loader_file_encoded函数 应该是判断代码是否被 zend-guard 加密</span></span><br><span class="line">  <span class="comment">#本质上下面2个分支实现的功能是一样的</span></span><br><span class="line">    $useStaticLoader = PHP_VERSION_ID &gt;= <span class="number">50600</span> &amp;&amp; !defined(<span class="string">'HHVM_VERSION'</span>) &amp;&amp; (!function_exists(<span class="string">'zend_loader_file_encoded'</span>) || !zend_loader_file_encoded());</span><br><span class="line">    <span class="keyword">if</span> ($useStaticLoader) &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">#加载下面的ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1类</span></span><br><span class="line">        <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/autoload_static.php'</span>;</span><br><span class="line">		</span><br><span class="line">      <span class="comment">#初始化Loader</span></span><br><span class="line">        call_user_func(\Composer\Autoload\ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::getInitializer($loader));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $map = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/autoload_namespaces.php'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($map <span class="keyword">as</span> $namespace =&gt; $path) &#123;</span><br><span class="line">            $loader-&gt;set($namespace, $path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $map = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/autoload_psr4.php'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($map <span class="keyword">as</span> $namespace =&gt; $path) &#123;</span><br><span class="line">            $loader-&gt;setPsr4($namespace, $path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $classMap = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/autoload_classmap.php'</span>;</span><br><span class="line">        <span class="keyword">if</span> ($classMap) &#123;</span><br><span class="line">            $loader-&gt;addClassMap($classMap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#spl_autoload_register(array($this, 'loadClass'), true, $prepend);</span></span><br><span class="line">  	<span class="comment">#注册正式的自动加载</span></span><br><span class="line">    $loader-&gt;register(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">#下面加载静态文件 类似一些全局函数文件</span></span><br><span class="line">    <span class="keyword">if</span> ($useStaticLoader) &#123;</span><br><span class="line">        $includeFiles = Composer\Autoload\ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::$files;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $includeFiles = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/autoload_files.php'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($includeFiles <span class="keyword">as</span> $fileIdentifier =&gt; $file) &#123;</span><br><span class="line">        composerRequireff0a7bcb47a4ebf1366823fdce0566b1($fileIdentifier, $file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $loader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我在看<code>platform_check.php</code>文件的代码，应该主要是用来检查PHP版本与扩展载入的情况</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$issues = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个文件应该是运行Composer 从composer.json中自动生成的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里判断PHP版本是超过当前版本</span></span><br><span class="line"><span class="keyword">if</span> (!(PHP_VERSION_ID &gt;= <span class="number">80000</span>)) &#123;</span><br><span class="line">    $issues[] = <span class="string">'Your Composer dependencies require a PHP version "&gt;= 8.0.0". You are running '</span> . PHP_VERSION  .  <span class="string">'.'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里判断哪些扩展没有载入</span></span><br><span class="line">$missingExtensions = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用 || 来简化代码. ||如果第一个条件为true则后面不再运行</span></span><br><span class="line"><span class="comment"># 同理 &amp;&amp; 如果第一个条件为false则后面不再运行</span></span><br><span class="line">extension_loaded(<span class="string">'bcmath'</span>) || $missingExtensions[] = <span class="string">'bcmath'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($missingExtensions) &#123;</span><br><span class="line">    $issues[] = <span class="string">'Your Composer dependencies require the following PHP extensions to be installed: '</span> . implode(<span class="string">', '</span>, $missingExtensions);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($issues) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Composer detected issues in your platform:'</span> . <span class="string">"\n\n"</span> . implode(<span class="string">"\n"</span>, $issues);</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">104</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>\Composer\Autoload\ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::getInitializer($loader)</code>代码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInitializer</span><span class="params">(ClassLoader $loader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> \Closure::bind(<span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($loader)</span> </span>&#123;</span><br><span class="line">      	<span class="comment">#通过PSR4的路径首字母来搜索路径</span></span><br><span class="line">        $loader-&gt;prefixLengthsPsr4 = ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::$prefixLengthsPsr4;</span><br><span class="line">      <span class="comment">#通过PSR4前缀与文件路径的对应</span></span><br><span class="line">        $loader-&gt;prefixDirsPsr4 = ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::$prefixDirsPsr4;</span><br><span class="line">      <span class="comment">#通过PSR0的首字母和类的对应</span></span><br><span class="line">        $loader-&gt;prefixesPsr0 = ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::$prefixesPsr0;</span><br><span class="line">      <span class="comment">#Class与路径的map</span></span><br><span class="line">        $loader-&gt;classMap = ComposerStaticInitff0a7bcb47a4ebf1366823fdce0566b1::$classMap;</span><br><span class="line"></span><br><span class="line">    &#125;, <span class="keyword">null</span>, ClassLoader::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后最关键的<code>ClassLoader</code>中的加载方法<code>loadClass</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadClass</span><span class="params">($class)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">#如果findFile的话就加载文件</span></span><br><span class="line">    <span class="keyword">if</span> ($file = <span class="keyword">$this</span>-&gt;findFile($class)) &#123;</span><br><span class="line">        includeFile($file);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">findFile</span><span class="params">($class)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment"># 之前在去composer中的class映射去找文件</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;classMap[$class])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;classMap[$class];</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">#如果composer开启了classmap-authoritative或者之前就有找不到的泪</span></span><br><span class="line">  	<span class="comment">#classmap-authoritative的优化也是 直接从classmap中找 不去下面psr4匹配</span></span><br><span class="line">  	<span class="comment">#就直接return false</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;classMapAuthoritative || <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;missingClasses[$class])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">#如果composer开启了apcu缓存则这里会去寻找命中缓存</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> !== <span class="keyword">$this</span>-&gt;apcuPrefix) &#123;</span><br><span class="line">        $file = apcu_fetch(<span class="keyword">$this</span>-&gt;apcuPrefix.$class, $hit);</span><br><span class="line">        <span class="keyword">if</span> ($hit) &#123;</span><br><span class="line">            <span class="keyword">return</span> $file;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = <span class="keyword">$this</span>-&gt;findFileWithExtension($class, <span class="string">'.php'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是HHVM的话 就去找hh文件</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">false</span> === $file &amp;&amp; defined(<span class="string">'HHVM_VERSION'</span>)) &#123;</span><br><span class="line">        $file = <span class="keyword">$this</span>-&gt;findFileWithExtension($class, <span class="string">'.hh'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">#如果apcu缓存存在则缓存类 下次用apcu缓存寻找</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> !== <span class="keyword">$this</span>-&gt;apcuPrefix) &#123;</span><br><span class="line">        apcu_add(<span class="keyword">$this</span>-&gt;apcuPrefix.$class, $file);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#如果找不到类 则直接加到missing数组中 下次不用再找</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">false</span> === $file) &#123;</span><br><span class="line">        <span class="comment">// Remember that this class does not exist.</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;missingClasses[$class] = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $file;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">findFileWithExtension</span><span class="params">($class, $ext)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 这里拼接命名空间的文件名</span></span><br><span class="line">    $logicalPathPsr4 = strtr($class, <span class="string">'\\'</span>, DIRECTORY_SEPARATOR) . $ext;</span><br><span class="line"><span class="comment">#取首字母 根据之前的PSR4首字母去寻找文件</span></span><br><span class="line">    $first = $class[<span class="number">0</span>];</span><br><span class="line">  	<span class="comment">#根据PSR4规则去寻找</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;prefixLengthsPsr4[$first])) &#123;</span><br><span class="line">        $subPath = $class;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">false</span> !== $lastPos = strrpos($subPath, <span class="string">'\\'</span>)) &#123;</span><br><span class="line">            $subPath = substr($subPath, <span class="number">0</span>, $lastPos);</span><br><span class="line">            $search = $subPath . <span class="string">'\\'</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;prefixDirsPsr4[$search])) &#123;</span><br><span class="line">                $pathEnd = DIRECTORY_SEPARATOR . substr($logicalPathPsr4, $lastPos + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;prefixDirsPsr4[$search] <span class="keyword">as</span> $dir) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file_exists($file = $dir . $pathEnd)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> $file;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PSR-4 fallback dirs</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;fallbackDirsPsr4 <span class="keyword">as</span> $dir) &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($file = $dir . DIRECTORY_SEPARATOR . $logicalPathPsr4)) &#123;</span><br><span class="line">            <span class="keyword">return</span> $file;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据PSR0规则去寻找</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">false</span> !== $pos = strrpos($class, <span class="string">'\\'</span>)) &#123;</span><br><span class="line">        <span class="comment">// namespaced class name</span></span><br><span class="line">        $logicalPathPsr0 = substr($logicalPathPsr4, <span class="number">0</span>, $pos + <span class="number">1</span>)</span><br><span class="line">            . strtr(substr($logicalPathPsr4, $pos + <span class="number">1</span>), <span class="string">'_'</span>, DIRECTORY_SEPARATOR);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// PEAR-like class name</span></span><br><span class="line">        $logicalPathPsr0 = strtr($class, <span class="string">'_'</span>, DIRECTORY_SEPARATOR) . $ext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;prefixesPsr0[$first])) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;prefixesPsr0[$first] <span class="keyword">as</span> $prefix =&gt; $dirs) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> === strpos($class, $prefix)) &#123;</span><br><span class="line">                <span class="keyword">foreach</span> ($dirs <span class="keyword">as</span> $dir) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file_exists($file = $dir . DIRECTORY_SEPARATOR . $logicalPathPsr0)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> $file;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PSR-0 fallback dirs</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;fallbackDirsPsr0 <span class="keyword">as</span> $dir) &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($file = $dir . DIRECTORY_SEPARATOR . $logicalPathPsr0)) &#123;</span><br><span class="line">            <span class="keyword">return</span> $file;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PSR-0 include paths.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;useIncludePath &amp;&amp; $file = stream_resolve_include_path($logicalPathPsr0)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面就是Composer自动加载的规则了。看完之前基本可以总结成</p>
<blockquote>
<p>Composer会先去classMap中寻找映射类 这里提现出composer autoload dump -o 的重要性</p>
<p>哪怕是apcu缓存都要比classMap慢一步 更别说下面的psr4和psr0的规则寻找了</p>
</blockquote>


    <!-- 显示photos -->
    

  </div>
  <div class="post-tags">
    
  </div>
</article>
  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <a href="/2020/12/08/php8/" rel="next" title="php8的新特性">
            <span>〈 </span> php8的新特性
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
        
      </div>
    </div>
  



    </div>

    

  </div>

  <footer class="footer text-center">
    <div id="bottom-inner">
      
        <a href="http://hexo.io" target="_blank" class="footer-link">Hexo</a>
      
        <a href="https://github.com/microacup/hexo-theme-micorb" target="_blank" class="footer-link">Theme microb</a>
      
    </div>
  </footer>
  

<script>
  // var titleTime,originTitle=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="[闷声发大财中...] "+originTitle,clearTimeout(titleTime)):(document.title="[+1s] "+originTitle,titleTime=setTimeout(function(){document.title=originTitle},2e3))});
</script>

<script>
  // (function (window, document) {
  //   window.requestAnimationFrame = (function () {
  //     return window.requestAnimationFrame ||
  //       window.webkitRequestAnimationFrame ||
  //       window.mozRequestAnimationFrame ||
  //       window.oRequestAnimationFrame ||
  //       window.msRequestAnimationFrame ||
  //       function (callback) {
  //         setTimeout(callback, 1000 / 60);
  //       }
  //   })();

  //   function init() {
  //     addMenuEvent();
  //   }
  //   init();

  //   function addMenuEvent() {
  //     var menu = document.getElementById('menu-main-post');
  //     if (menu) {
  //       var toc = document.getElementById('toc');
  //       menu.title = toc ? '目录' : '回到顶部';
  //       menu.onclick = function () {
  //         if (toc) {
  //           if (toc.style.display == 'block') {
  //             toc.style.display = 'none';
  //           } else {
  //             toc.style.display = 'block';
  //           }
  //         } else {
  //           returnTop();
  //         }
  //       };
  //     }
  //   }

  //   var timer = null;

  //   function returnTop() {
  //     cancelAnimationFrame(timer);
  //     timer = requestAnimationFrame(function fn() {
  //       var oTop = document.body.scrollTop || document.documentElement.scrollTop;
  //       if (oTop > 0) {
  //         document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
  //         timer = requestAnimationFrame(fn);
  //       } else {
  //         cancelAnimationFrame(timer);
  //       }
  //     });
  //   }

  // })(window, document);
</script>


  



</body>
</html>
